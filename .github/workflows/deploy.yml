name: deploy

on:
  workflow_run:
    workflows: ["tests"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Extract tag name from commit message
        id: extract_tag
        run: |
          echo "Commit message: ${{ github.event.workflow_run.head_commit.message }}"
          TAG=$(echo "${{ github.event.workflow_run.head_commit.message }}" | grep -oE 'v[0-9]+\.[0-9]+\.[0-9]+')
          echo "Found tag: $TAG"
          if [[ -z "$TAG" ]]; then
            echo "Not a version tag, skipping."
            exit 1
          fi
          echo "tag=$TAG" >> $GITHUB_OUTPUT

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

    #   - name: Build Docker image (but donâ€™t push)
    #     uses: docker/build-push-action@v5
    #     with:
    #       context: .
    #       push: false
    #       tags: yourdockerhubuser/yourapp:${{ steps.extract_tag.outputs.tag }}
